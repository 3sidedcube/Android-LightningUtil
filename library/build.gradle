apply plugin: 'com.android.library'

android {
	compileSdkVersion 26
	buildToolsVersion "26.0.2"

	defaultConfig {
		minSdkVersion 16
		targetSdkVersion 26
	}

	packagingOptions {
		exclude 'META-INF/DEPENDENCIES.txt'
		exclude 'META-INF/LICENSE.txt'
		exclude 'META-INF/NOTICE.txt'
		exclude 'META-INF/NOTICE'
		exclude 'META-INF/LICENSE'
		exclude 'META-INF/DEPENDENCIES'
		exclude 'META-INF/notice.txt'
		exclude 'META-INF/license.txt'
		exclude 'META-INF/dependencies.txt'
		exclude 'META-INF/LGPL2.1'
		exclude 'LICENSE.txt'
	}

	lintOptions {
		abortOnError false
	}
}

dependencies {
	compile 'com.android.support:support-annotations:26.0.2'
	compile 'org.projectlombok:lombok:1.14.8'
	compile 'com.google.code.gson:gson:2.7'
}

def srcJava = 'src/main/java'
def srcDelomboked = 'build/src-delomboked/main/java'

task delombok(type: Exec) {
	commandLine 'java', '-jar', 'libs/lombok.jar', 'delombok', 'src', '-d', 'build/src-delomboked'
}

def findClasses(File path)
{
	List<File> found = new ArrayList<File>();

	for (File file : path.listFiles())
	{
		if (file.getName().equalsIgnoreCase("classes.jar"))
		{
			found.add(file);
		}

		if (file.isDirectory())
		{
			found.addAll(findClasses(file));
		}
	}

	return found;
}

android.libraryVariants.all { variant ->
	task("generate${variant.name.capitalize()}Javadoc", type: Javadoc) {
		description "Generates Javadoc for $variant.name."

		setDependsOn(['build', 'delombok'])
		source = srcDelomboked

		ext.androidJar = "${android.sdkDirectory}/platforms/${android.compileSdkVersion}/android.jar"
		classpath = files(variant.javaCompile.classpath.files) + files(ext.androidJar)

		List<String> jars = new ArrayList<String>();
		File dependencies = new File("build/intermediates/exploded-aar/")
		for (File folder : dependencies.listFiles())
		{
			List<File> found = findClasses(folder);
			for (File foundFile : found)
			{
				classpath += files(foundFile.getAbsolutePath())
			}
		}

		options.links("http://google-gson.googlecode.com/svn/trunk/gson/docs/javadocs/", "com.google.gson")
		options.linksOffline("http://d.android.com/reference", "${android.sdkDirectory}/docs/reference");
		options.links("http://docs.oracle.com/javase/7/docs/api/");
		options.encoding("utf-8")

		// exclude generated files
		exclude '**/BuildConfig.java'
		exclude '**/R.java'

		// exclude any internal packages
		exclude '**/com/acme/sdk/api/**'
	}
}

//apply from: '../gradle/sonatype.gradle'
apply from: '../gradle/artifactory.gradle'

